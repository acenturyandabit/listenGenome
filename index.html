<html>
<body>
    <h1>Genome player</h1>
    <h2>Paste a genome below.</h2>
    <h3> You can go to <a href="https://www.ncbi.nlm.nih.gov/nuccore/">https://www.ncbi.nlm.nih.gov/nuccore/</a>to find the genome of all sorts of things, like humans!</h3>
    <textarea placeholder="This will remove any non-ACTG text automatically as well.">
        
    </textarea>
    <button>Play</button>
    <script>
        let positions="ACTG";
        function createParams(params, letters){
            delete params.f;
            params.mstart=params.start;
            let noteIndex=positions.indexOf(letters[0])*4+positions.indexOf(letters[1]);
            switch (noteIndex){
                case 15:
                    params.baseline++;
                    break;
                case 14:
                    params.baseline--;
                    break;
                case 13: 
                    params.baseline+=12;
                    break;
                case 12:
                    params.baseline-=12;
                    break;
                default:
                    params.f=440*Math.pow(2,(noteIndex+params.baseline)/12);
                    // timings
                    switch (letters[2]){
                        case 'A':
                            params.start+=0.25;
                            params.end=params.mstart+0.25;
                            break;
                        case 'C':
                            params.start+=0.125;
                            params.end=params.mstart+0.125;
                            break;
                        case 'G':
                            params.start+=0.125;
                            params.end=params.mstart+0.25;
                            break;
                        case 'T':
                            params.start+=0.25;
                            params.end=params.mstart+0.5;
                            break;
                    }
                    break;
            }
            return params;
        }

        let isPlaying=false;
        let auctx;
        document.querySelector("button").addEventListener("click",(e)=>{
            if (isPlaying){
                isPlaying=false;
                document.querySelector("button").innerText="Play";
                auctx.close();
            }else{
                isPlaying=false;
                document.querySelector("button").innerText="Stop";
                auctx=new AudioContext();
                let buffer=document.querySelector("textarea").value;
                buffer=buffer.toUpperCase();
                buffer=buffer.replace(/[^ACTG]/g,"");
                let threeletter=/.../g;
                let bArr=[];
                while (res=threeletter.exec(buffer)){
                    bArr.push(res[0]);
                }
                let params={mstart:0,start:auctx.currentTime+0.1,baseline:0};
                /*
                    start: when should the next node start. set by past for me.
                    end: when should note end. set by me for me.
                    baseline: the base frequency
                    f: what note to play. set by me for me.
                */
                bArr=bArr.map(i=>{
                    params=createParams(params,i);
                    if (params.f){
                        let ON = new OscillatorNode(auctx,{frequency:params.f,type:'sine'});
                        ON.start(params.mstart);
                        ON.stop(params.end);
                        ON.connect(auctx.destination);
                    }
                })
            }
        })
    </script>
</body>
</html>

